<app>
    <header></header>
    <div id="intro"></div>
    <div id="main"></div>
    <div id="overlay"></div>
    <div id="instructions"></div>
    <div id="answers"></div>
    <footer></footer>


    <script>
        let app = this;
        let tags = State();

        app.intro = function() {
            tags.mount("intro", "intro", {"onclick": app.setup});
        };


        app.setup = function() {
            tags.unmount("intro");
            tags.mount("answers", "confirm", {"onclick": app.startCountdown});
            tags.mount("instructions", "instructions_rules");
        };


        app.startCountdown = function() {
            tags.unmount("answers");
            tags.unmount("instructions");
            tags.mount("answers", "answers", {"answers": opts.answers, "correct": opts.correct, "disabled": true, "onselected": app.humanFinished});
            tags.mount("main", "countdown", {"length": 5, "ontimeout": app.startChallenge});
        };

        app.startChallenge = function() {
            tags.unmount("main");
            tags.mount("main", "challenge", {"image": opts.image});
            tags.update("answers", {"disabled": false});

            // fake the AI
            app.aiTimeout = setTimeout(app.machineFinished, 300);
        };

        app.humanFinished = function(result){
            if (result == RESULT.CORRECT) {
                clearTimeout(app.aiTimeout);
                tags.update("answers", {"disabled": true});
                tags.mount("overlay", "overlay");
                tags.mount("instructions", "instructions_round1_user_wins");
            }
            // todo incorrect
        };


        app.machineFinished = function(){
            tags.unmount("answers");
            tags.mount("overlay", "overlay");
            tags.mount("instructions", "instructions_round1_ai_wins");
        };

        this.on("mount", app.intro);
    </script>

</app>

<confirm>
    <button onclick={opts.onclick} class="button-primary">Alles klar!</button>
</confirm>
