<ai>
    <img id="img" src={opts.image} crossorigin="anonymous"/>

    <script>
        let tag = this;
        tag.model = null;
        tag.predicted = false;

        mobilenet.load().then(mobilenet => tag.model=mobilenet);

        // based on https://observablehq.com/@mbostock/imagenet-hierarchy
        tag.mapping = {"Katze" :["Egyptian cat", "Persian cat", "Siamese cat", "tabby, tabby cat", "tiger cat", "cougar, puma, catamount, mountain lion, painter, panther, Felis concolor", "lynx, catamount"],
                       "Strand": ["seashore, coast, seacoast, sea-coast"],
                       "Boot": ["speedboat"]};

        tag.predict = function() {
            if (!opts.disabled) {
                let img = document.getElementById('img');
                tag.model.classify(img, 3).then(tag.checkAnswer);
                tag.predicted = true;
            }
        };

        tag.checkAnswer = function(topPredictions){
            let top = topPredictions[0];
            let correct = opts.answers[opts.correct];

            if ((top.probability >= 0.5) && (tag.mapping[correct].includes(top.className)))
                opts.onselected(RESULT.CORRECT);
            else
                opts.onselected(RESULT.INCORRECT);
        };

        this.on("update", tag.predict);

    </script>
</ai>