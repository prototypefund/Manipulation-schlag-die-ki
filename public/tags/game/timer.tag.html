<timer>
    <progress value={this.value} max={this.max}></progress>

    <script>
        let tag = this;

        /* parameters given to this tag
        opts.length: Length of the timer (in seconds)
        opts.controller: observable for communicating/controlling status of the timer, supports the following messages
               start: (from parent) trigger start of the timer
               stop: (from parent) trigger stopping of the timer
               timeout: (from this tag) timer has run out
        */
        opts.length = Number(opts.length) || 10;

        // calculate settings for progress bar
        tag.max = opts.length * 1000;  // to milliseconds
        tag.value = 0;
        tag.stepTime = 10;   // in milliseconds
        tag.stepSize = tag.stepTime;
        tag.timer = null;

        tag.initTimer = function() {
            tag.timer = setInterval(tag.updateValue, tag.stepTime);
        };

        tag.updateValue = function() {
            tag.value += tag.stepSize;
            tag.update();

            if (tag.value >= tag.max) {
                tag.stopTimer();
                opts.callback();
            }
        };

        tag.stopTimer = function(){
            clearInterval(tag.timer);
        };


        opts.controller.on("start", tag.initTimer);
        opts.controller.on("stop", tag.stopTimer);
    </script>

</timer>
